---
layout: post
title: "C++中逗号表达式的一个应用"
date: 2015-10-22 23:55:35 +0800
comments: true
categories: C++
tags: [C++, 逗号表达式, 优雅]
keywords: C++, 逗号表达式, 优雅, 性能
description: C++的逗号表达式的一个应用和trick
---


假设我们的程序需要调用三个函数**f**，**g**，**h**。其中**f**和**h**可能失败，可能成功，而**g**一定成功。**f**和**h**有返回值，**g**没有返回值。我们可能得写这样的代码：

    if (f()!=SUCCESS) {
      //abort
    } else {
      g();
      if (h()!=SUCCESS) {
      }
    }

由于**g**没有返回值，因此这么写似乎是天经地义的。能不能优雅点？

<!--more-->

借助于逗号表达式，我们可以这样：

    if (f()!=SUCCESS){
    } else if (g(),false) { //逗号表达式
      //we will never be here...
    } else if (h()!=SUCCESS) {
    }
    
形式上更加优美，但是和之前的写法相比可读性较差，并且使用了三次比较，之前只需要两次比较。

在**C++**中，逗号表达式有时候是一种很有用的工具：(**A,B,C**)，则从左到右求值，最后**C**的（返回）值作为整个表达式的值。
